const f=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};f();function c(){return window.innerWidth<=800&&window.innerHeight<=930}const u={desktop:{"account-setup":{height:"334px",width:"375px"},timeline:{height:"70vh",width:"375px"}},mobile:{"account-setup":{height:"100vh",width:"100vw"},timeline:{height:"100vh",width:"100vw"}}};function s(t){const e=document.querySelector(".chatterbox-iframe"),n=document.querySelector(".start");if(t&&e.style.display==="block"){e.contentWindow.postMessage({action:"minimize"},"*"),e.contentWindow.postMessage({action:"maximize"},"*");return}e.style.display&&e.style.display!=="none"?(e.style.display="none",document.querySelector(".start-chat-btn").classList.remove("start-background-minimized"),e.contentWindow.postMessage({action:"minimize"},"*"),c()&&(n.style.display="block")):(e.contentWindow.postMessage({action:"maximize"},"*"),e.style.display="block",document.querySelector(".start-chat-btn").classList.add("start-background-minimized"),c()&&(n.style.display="none"))}function h(t){const{view:e}=t,n=c()?"mobile":"desktop",r=u[n][e];if(!r)return;const{height:o,width:i}=r,a=document.querySelector(".chatterbox-iframe");o&&(a.style.height=o),i&&(a.style.width=i)}function p(){const t=document.querySelector(".chatterbox-iframe");t==null||t.remove(),document.querySelector(".start").remove()}const d=document.querySelector("#chatterbox-script").src,l=new URL(d).origin;async function g(){x();const t=document.createElement("div");t.className="start";const e=window.CHATTERBOX_CONFIG_LOCATION;let n=[];try{const o=await(await fetch(new URL(e,l))).json();n=o==null?void 0:o.invite_users}catch(r){console.error("Can not load config",r)}n.length===0&&n.push(null),n.forEach(r=>{const o=b(r);t.appendChild(o)}),document.body.appendChild(t),window.localStorage.getItem("chatterbox-should-load-in-background")&&m(!0)}function b(t){const e=document.createElement("button");return e.className="start-chat-btn",t&&(e.id=`${t}`),e.setAttribute("aria-label","Start chat"),e.innerHTML=t?t.replace("@","").replace(":matrix.org",""):"",e.onclick=()=>{const n=!!window.CURRENT_USERNAME&&window.CURRENT_USERNAME!==t;window.CURRENT_USERNAME=t,window.isIframeLoaded?s(n):m()},e.appendChild(w(t)),e}function w(t){const e=document.createElement("span");return e.className="notification-badge hidden",e.id=`notification-badge-${t}`,e}function x(){const t=document.createElement("link");t.rel="stylesheet",t.href=new URL("parent.2d06a015.css",d).href,document.head.appendChild(t)}function m(t=!1){const e=document.createElement("iframe"),n=window.CHATTERBOX_CONFIG_LOCATION;if(!n)throw new Error("CHATTERBOX_CONFIG_LOCATION is not set");e.src=new URL(`../chatterbox.html?config=${n}${t?"&minimized=true":""}`,l).href,e.className="chatterbox-iframe",document.body.appendChild(e),window.isIframeLoaded=!0,document.querySelector(".start-chat-btn").classList.add("start-background-minimized"),c()&&(document.querySelector(".start").style.display="none")}window.isIframeLoaded=!1;window.__chatterbox=()=>{var t;return(t=document.querySelector(".chatterbox-iframe"))==null?void 0:t.contentWindow};function y({userId:t,count:e}){const n=document.getElementById(`notification-badge-${t}`);e===0?n.classList.add("hidden"):(n.innerText=`${e}`,n.classList.remove("hidden"))}window.addEventListener("message",t=>{const{action:e}=t.data;switch(e){case"resize-iframe":t.data.view==="timeline"&&window.localStorage.setItem("chatterbox-should-load-in-background","true"),h(t.data);break;case"minimize":s(!1);break;case"unread-message":y(t.data.payload);break;case"error":p();break}});g();
